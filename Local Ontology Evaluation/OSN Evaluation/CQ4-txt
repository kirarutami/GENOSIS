PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX ex: <http://www.w3.org/2002/07/owl#>  # Sesuaikan dengan namespace RDF Anda

SELECT ?suspect ?victim ?platform ?messageText ?messageTimestamp ?category
WHERE {
  ?message rdf:type ex:TextMessage ;
           ex:hasMessageText ?messageText ;
           ex:hasMessageSendTimestamp ?messageTimestamp ;
           ex:sendsTextMessage ?suspect ;
           ex:viewsMessages ?victim ;
           ex:belongsToPlatform ?platform .

  # Klasifikasi Pesan sebagai Ancaman, Pemerasan, atau Pelecehan Verbal
  BIND (
    IF (
      REGEX(?messageText, "end it", "i") || 
      REGEX(?messageText, "ruin your life", "i") ||
      REGEX(?messageText, "watch your back", "i") ||
      REGEX(?messageText, "just disappear", "i"),
      "Threat",
      ""
    ) AS ?threat
  )
  
  BIND (
    IF (
      REGEX(?messageText, "pay me or else", "i") ||
      REGEX(?messageText, "I have private pictures", "i") ||
      REGEX(?messageText, "transfer or I will", "i"),
      "Blackmail",
      ""
    ) AS ?blackmail
  )

  BIND (
    IF (
      REGEX(?messageText, "nobody likes you", "i") ||
      REGEX(?messageText, "loser", "i") ||
      REGEX(?messageText, "ugly", "i"),
      "Verbal Abuse",
      ""
    ) AS ?verbalAbuse
  )

  # Tentukan kategori utama
  BIND (
    COALESCE(?threat, ?blackmail, ?verbalAbuse, "Unclassified") AS ?category
  )
}
ORDER BY ?suspect ?messageTimestamp